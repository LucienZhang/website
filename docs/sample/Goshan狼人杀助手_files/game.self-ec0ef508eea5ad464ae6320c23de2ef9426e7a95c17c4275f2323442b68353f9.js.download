(function() {
  $(document).on('turbolinks:load', function(e) {
    if ($('#easy_login_session').length !== 0 && !App.game) {
      return App.game = App.cable.subscriptions.create({
        channel: "GameChannel",
        f: $('#easy_login_session').attr('f')
      }, {
        connected: function() {
          return console.log("connected socket channel GameChannel");
        },
        disconnected: function() {
          return console.log("disconnected socket channel GameChannel");
        },
        received: function(data) {
          if ($('#easy_login_session').length !== 0) {
            console.log("received data:");
            console.log(data);
            if (data.action === 'alert') {
              return Wolf.modal.alert(data);
            } else if (data.action === 'show_role') {
              return Wolf.modal.display_role(data);
            } else if (data.action === 'panel') {
              return Wolf.panel.updateWithData(data);
            } else if (data.action === 'dialog') {
              return Wolf.modal.dialog(data);
            } else if (data.action === 'update') {
              if (!Wolf.Utils.varIsNull(data.status)) {
                Wolf.status.update(data.status);
                Wolf.panel.updateWithTurn(data.status.turn);
              }
              if (!Wolf.Utils.varIsNull(data.players)) {
                return Wolf.panel.players = data.players;
              }
            } else if (data.action === 'bid_info') {
              return Wolf.modal.display_bid_info(data);
            }
          }
        },
        "do": function(action, pos) {
          if (pos == null) {
            pos = null;
          }
          if (pos !== null) {
            console.log(action + " to pos: " + pos);
            return this.perform(action, {
              pos: pos
            });
          } else {
            console.log("" + action);
            return this.perform(action);
          }
        }
      });
    }
  });

}).call(this);
